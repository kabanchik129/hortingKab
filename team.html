<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•–æ—Ä—Ç–∏–Ω–≥ - –ö–æ–º–∞–Ω–¥–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="team-header">
            <div>
                <h1 id="teamName">–ö–æ–º–∞–Ω–¥–∞</h1>
                <p id="userRole">–†–æ–ª—å: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>
            <div class="user-info">
                <div id="adminViewControls" style="display: none;">
                    <button class="back-to-admin" onclick="exitViewMode()">
                        ‚Üê –ù–∞–∑–∞–¥ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ
                    </button>
                </div>
                <p id="userInfo"></p>
                <button class="logout-btn" onclick="logout()">–í–∏–π—Ç–∏</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('main')">–ì–æ–ª–æ–≤–Ω–∞</button>
            <button class="tab-btn" onclick="showTab('members')">–°–∫–ª–∞–¥ –∫–æ–º–∞–Ω–¥–∏</button>
            <button class="tab-btn" onclick="showTab('notifications')">–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</button>
            <button class="tab-btn" onclick="showTab('tasks')">–ó–∞–≤–¥–∞–Ω–Ω—è</button>
            <button class="tab-btn" onclick="showTab('absence')">–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç–∞ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è</button>
        </div>

        <main>
            <!-- –í–∫–ª–∞–¥–∫–∞ –ì–ª–∞–≤–Ω–∞—è -->
            <div id="mainTab">
                <div class="section">
                    <h3>–ó–∞–≥–∞–ª—å–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h3>
                    <div id="globalNotificationsTeam"></div>
                </div>
                
                <div class="section">
                    <h3>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏</h3>
                    <div id="teamNotifications"></div>
                    <div id="addNotificationSection" style="display: none;">
                        <button class="enhanced-btn" onclick="showAddNotificationForm()">+ –î–æ–¥–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</button>
                    </div>
                </div>
                
                <div class="section">
                    <h3>–ù–∞–π–±–ª–∏–∂—á—ñ –∑–∞–Ω—è—Ç—Ç—è</h3>
                    <div id="nextTrainings"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ—Å—Ç–∞–≤ -->
            <div id="membersTab" style="display: none;">
                <div class="section">
                    <h3>–°–∫–ª–∞–¥ –∫–æ–º–∞–Ω–¥–∏</h3>
                    <div id="membersList"></div>
                    <div id="addMemberSection" style="display: none;">
                        <button class="enhanced-btn" onclick="showAddMemberForm()">+ –î–æ–¥–∞—Ç–∏ —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∏</button>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
            <div id="notificationsTab" style="display: none;">
                <div class="section">
                    <h3>–í—Å—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏</h3>
                    <div id="allTeamNotifications"></div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ó–∞–¥–∞—á–∏ -->
            <div id="tasksTab" style="display: none;">
                <div class="section">
                    <h3>–ó–∞–≤–¥–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏</h3>
                    <div id="tasksList"></div>
                    <div id="addTaskSection" style="display: none;">
                        <button class="enhanced-btn" onclick="showAddTaskForm()">+ –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –û–±—Ä–∞—â–µ–Ω–∏—è -->
            <div id="absenceTab" style="display: none;">
                <div class="section">
                    <h3>–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å</h3>
                    <div class="enhanced-card">
                        <p><strong>–£–≤–∞–≥–∞:</strong> –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –≤ –¥–µ–Ω—å –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –æ 23:59</p>
                        <div class="form-row" style="margin-top: 20px;">
                            <input type="text" class="enhanced-input" id="absenceName" placeholder="–í–∞—à–µ —ñ–º'—è">
                            <input type="date" class="enhanced-input" id="absenceDate">
                            <select class="enhanced-select" id="absenceReason">
                                <option value="—Ö–≤–æ—Ä–æ–±–∞">–•–≤–æ—Ä–æ–±–∞</option>
                                <option value="—Å—ñ–º–µ–π–Ω—ñ –æ–±—Å—Ç–∞–≤–∏–Ω–∏">–°—ñ–º–µ–π–Ω—ñ –æ–±—Å—Ç–∞–≤–∏–Ω–∏</option>
                                <option value="–Ω–∞–≤—á–∞–Ω–Ω—è">–ù–∞–≤—á–∞–Ω–Ω—è</option>
                                <option value="—ñ–Ω—à–µ">–Ü–Ω—à–∞ –ø—Ä–∏—á–∏–Ω–∞</option>
                            </select>
                            <button class="enhanced-btn" onclick="reportAbsence()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏—Ä—É</button>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ</h3>
                    <div id="absencesList"></div>
                </div>
                
                <div class="section">
                    <h3>–ó–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                    <div class="enhanced-card">
                        <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º–∏</p>
                        <div class="form-row" style="margin-top: 20px;">
                            <textarea class="enhanced-textarea" id="adminMessage" placeholder="–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É..." rows="3" style="grid-column: 1 / -1;"></textarea>
                            <select class="enhanced-select" id="messageType" style="grid-column: span 2;">
                                <option value="–ø—Ä–æ–±–ª–µ–º–∞">–ü—Ä–æ–±–ª–µ–º–∞ –∑ —Å–∞–π—Ç–æ–º</option>
                                <option value="–ø–∏—Ç–∞–Ω–Ω—è">–ó–∞–ø–∏—Ç–∞–Ω–Ω—è</option>
                                <option value="–ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è">–ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è</option>
                                <option value="—ñ–Ω—à–µ">–Ü–Ω—à–µ</option>
                            </select>
                            <button class="enhanced-btn" onclick="sendAdminMessage()" style="grid-column: span 2;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É</button>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">–ú–æ—ó –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è</h3>
                    <div id="myMessagesList"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        let currentUser = null;
        let currentTeam = null;
        let canEdit = false;
        let isAdminView = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initTeamPage() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∞–¥–º–∏–Ω –ª–∏ —ç—Ç–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
            const adminView = sessionStorage.getItem('horting_admin_view');
            const viewTeam = sessionStorage.getItem('horting_view_team');
            
            if (adminView === 'true' && viewTeam) {
                // –ê–¥–º–∏–Ω –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
                isAdminView = true;
                currentUser = {
                    role: 'admin_view',
                    teamId: parseInt(viewTeam),
                    isCommander: true,
                    isDeputy: true,
                    teamType: viewTeam <= 3 ? 'mal' : 'str'
                };
                canEdit = true; // –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞
                document.getElementById('adminViewControls').style.display = 'block';
                
                document.getElementById('userInfo').textContent = 
                    `–ü–µ—Ä–µ–≥–ª—è–¥ –∫–æ–º–∞–Ω–¥–∏ ${viewTeam}`;
                document.getElementById('userRole').innerHTML = 
                    `<span class="view-mode-indicator">üîç –†–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É –∞–¥–º—ñ–Ω–∞</span>`;
                    
            } else {
                // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                isAdminView = false;
                currentUser = checkAuth();
                if (!currentUser) return;
                
                if (currentUser.role === 'admin') {
                    window.location.href = 'dashboard.html';
                    return;
                }
                
                if (!currentUser.teamId) {
                    logout();
                    return;
                }
                
                canEdit = currentUser.isCommander || currentUser.isDeputy;
                
                document.getElementById('userInfo').textContent = 
                    `–ö–æ–º–∞–Ω–¥–∞ ${currentUser.teamId} (${currentUser.teamType === 'mal' ? '–º–æ–ª–æ–¥—à—ñ' : '—Å—Ç–∞—Ä—à—ñ'})`;
                document.getElementById('userRole').textContent = 
                    `–†–æ–ª—å: ${currentUser.isCommander ? '–ö–æ–º–∞–Ω–¥–∏—Ä' : 
                            currentUser.isDeputy ? '–ó–∞—Å—Ç—É–ø–Ω–∏–∫' : '–ë–æ–µ—Ü—å'}`;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            loadTeamData();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (canEdit) {
                document.getElementById('addNotificationSection').style.display = 'block';
                document.getElementById('addMemberSection').style.display = 'block';
                document.getElementById('addTaskSection').style.display = 'block';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
            loadNextTrainings();
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è
            loadMyMessages();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤—Ç—Ä–∞—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('absenceDate').valueAsDate = tomorrow;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (!isAdminView) {
                const team = TeamManager.getTeam(currentUser.teamId);
                const member = team.members.find(m => m.callSign.includes('–ö–æ–º–∞–Ω–¥–∏—Ä') || m.callSign.includes('–ó–∞—Å—Ç—É–ø–Ω–∏–∫') || m.callSign);
                if (member) {
                    document.getElementById('absenceName').value = member.name;
                }
            }
            
            document.getElementById('teamName').textContent = 
                CONFIG.teams[currentUser.teamId].name;
        }

        function loadTeamData() {
            currentTeam = TeamManager.getTeam(currentUser.teamId);
            
            loadTeamMembers();
            loadTeamNotifications();
            loadAllTeamNotifications();
            loadGlobalNotificationsForTeam();
            loadTasks();
            loadAbsences();
        }

        function loadTeamMembers() {
            const container = document.getElementById('membersList');
            
            if (!currentTeam.members.length) {
                container.innerHTML = '<p>–©–µ –Ω–µ–º–∞—î —á–ª–µ–Ω—ñ–≤ –∫–æ–º–∞–Ω–¥–∏</p>';
                return;
            }
            
            container.innerHTML = currentTeam.members.map(member => `
                <div class="enhanced-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <strong style="color: #ffd60a; font-size: 1.1rem;">${member.callSign}</strong>
                        <p style="margin: 5px 0;">${member.name}</p>
                        <small style="color: #adb5bd;">${member.rank}</small>
                    </div>
                    <div>
                        <span class="role-badge ${member.role === 'command' ? 'role-kam' : 
                                                  member.role === 'deputy' ? 'role-zam' : ''}">
                            ${member.role === 'command' ? '–ö–æ–º–∞–Ω–¥–∏—Ä' : 
                             member.role === 'deputy' ? '–ó–∞—Å—Ç—É–ø–Ω–∏–∫' : '–ë–æ–µ—Ü—å'}
                        </span>
                        ${canEdit ? `
                            <button onclick="removeMember('${member.id}')" 
                                    class="enhanced-btn danger" 
                                    style="margin-left: 10px; padding: 6px 12px; font-size: 0.8rem;">
                                –í–∏–¥–∞–ª–∏—Ç–∏
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function loadTeamNotifications() {
            const container = document.getElementById('teamNotifications');
            const recent = currentTeam.notifications.slice(-5).reverse();
            
            if (!recent.length) {
                container.innerHTML = '<p>–©–µ –Ω–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</p>';
                return;
            }
            
            container.innerHTML = recent.map(notif => `
                <div class="enhanced-card">
                    <strong style="color: #ffd60a; font-size: 1.1rem;">${notif.title}</strong>
                    <p style="margin: 10px 0;">${notif.message}</p>
                    <div class="notification-date">
                        ${formatDate(notif.date)} ‚Ä¢ ${notif.author}
                    </div>
                </div>
            `).join('');
        }

        function loadAllTeamNotifications() {
            const container = document.getElementById('allTeamNotifications');
            const all = [...currentTeam.notifications].reverse();
            
            if (!all.length) {
                container.innerHTML = '<p>–©–µ –Ω–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</p>';
                return;
            }
            
            container.innerHTML = all.map(notif => `
                <div class="enhanced-card">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <strong style="color: #ffd60a; font-size: 1.1rem;">${notif.title}</strong>
                            <p style="margin: 10px 0;">${notif.message}</p>
                            <div class="notification-date">
                                ${formatDate(notif.date)} ‚Ä¢ ${notif.author}
                            </div>
                        </div>
                        ${canEdit ? `
                            <div>
                                <button onclick="deleteNotification('${notif.id}')" 
                                        class="enhanced-btn danger" 
                                        style="padding: 6px 12px; font-size: 0.8rem;">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function loadGlobalNotificationsForTeam() {
            const allNotifications = JSON.parse(localStorage.getItem('horting_global_notifications') || '[]');
            const container = document.getElementById('globalNotificationsTeam');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã
            const teamNotifications = allNotifications.filter(notif => 
                !notif.targetTeams || notif.targetTeams.includes(currentUser.teamId.toString())
            );
            
            const recent = teamNotifications.slice(-3).reverse();
            
            if (!recent.length) {
                container.innerHTML = '<p>–ù–µ–º–∞—î –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å</p>';
                return;
            }
            
            container.innerHTML = recent.map(notif => `
                <div class="enhanced-card" style="border-left-color: #ffd60a;">
                    <strong style="color: #ffd60a; font-size: 1.1rem;">${notif.title}</strong>
                    <p style="margin: 10px 0;">${notif.message}</p>
                    <div class="notification-date">
                        ${formatDate(notif.date)} ‚Ä¢ ${notif.author}
                    </div>
                </div>
            `).join('');
        }

        function loadTasks() {
            const container = document.getElementById('tasksList');
            const tasks = currentTeam.tasks;
            
            if (!tasks.length) {
                container.innerHTML = '<p>–©–µ –Ω–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å</p>';
                return;
            }
            
            container.innerHTML = tasks.map(task => `
                <div class="enhanced-card" style="border-left-color: ${task.completed ? '#1a936f' : '#ff9e00'}">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <strong style="color: ${task.completed ? '#1a936f' : '#ffd60a'}; font-size: 1.1rem;">
                                ${task.title}
                            </strong>
                            <p style="margin: 10px 0;">${task.description}</p>
                            <div class="notification-date">
                                ${formatDate(task.date)}
                            </div>
                        </div>
                        ${canEdit ? `
                            <div style="display: flex; flex-direction: column; gap: 5px;">
                                <button onclick="toggleTask('${task.id}')" 
                                        class="enhanced-btn ${task.completed ? 'secondary' : ''}" 
                                        style="padding: 6px 12px; font-size: 0.8rem; white-space: nowrap;">
                                    ${task.completed ? '–í—ñ–¥–Ω–æ–≤–∏—Ç–∏' : '–í–∏–∫–æ–Ω–∞–Ω–æ'}
                                </button>
                                <button onclick="deleteTask('${task.id}')" 
                                        class="enhanced-btn danger" 
                                        style="padding: 6px 12px; font-size: 0.8rem;">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function loadAbsences() {
            const container = document.getElementById('absencesList');
            const absences = currentTeam.absences;
            
            if (!absences.length) {
                container.innerHTML = '<p>–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç–µ–π</p>';
                return;
            }
            
            container.innerHTML = absences.map(abs => `
                <div class="enhanced-card" style="border-left-color: #ff6b6b;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <strong style="color: #ff6b6b; font-size: 1.1rem;">${abs.memberName}</strong>
                            <p style="margin: 5px 0;">–ù–µ –±—É–¥–µ: ${abs.date}</p>
                            <small style="color: #adb5bd;">–ü—Ä–∏—á–∏–Ω–∞: ${abs.reason}</small>
                        </div>
                        ${canEdit ? `
                            <div>
                                <button onclick="deleteAbsence('${abs.id}')" 
                                        class="enhanced-btn danger" 
                                        style="padding: 6px 12px; font-size: 0.8rem;">
                                    –í–∏–¥–∞–ª–∏—Ç–∏
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function loadMyMessages() {
            const container = document.getElementById('myMessagesList');
            const notifications = JSON.parse(localStorage.getItem('horting_admin_notifications') || '[]');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã
            const myMessages = notifications.filter(n => n.fromTeam == currentUser.teamId);
            
            if (!myMessages.length) {
                container.innerHTML = '<p>–í–∏ —â–µ –Ω–µ –Ω–∞–¥—Å–∏–ª–∞–ª–∏ –∑–≤–µ—Ä–Ω–µ–Ω—å</p>';
                return;
            }
            
            container.innerHTML = myMessages.reverse().map(msg => `
                <div class="enhanced-card" style="border-left-color: #9d4edd;">
                    <strong style="color: #9d4edd; font-size: 1.1rem;">
                        ${msg.message.split(']')[0]}]
                    </strong>
                    <p style="margin: 10px 0;">${msg.message.split('] ')[1] || msg.message}</p>
                    <div class="notification-date">
                        ${formatDate(msg.date)}
                        ${msg.read ? 
                            '<span style="color: #1a936f;">‚úì –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</span>' : 
                            '<span style="color: #ff9e00;">‚óè –û—á—ñ–∫—É—î —Ä–æ–∑–≥–ª—è–¥—É</span>'
                        }
                    </div>
                </div>
            `).join('');
        }

        function loadNextTrainings() {
            const container = document.getElementById('nextTrainings');
            const trainings = getNextTrainings(3);
            
            if (!trainings.length) {
                container.innerHTML = '<p>–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–Ω—è—Ç—å</p>';
                return;
            }
            
            container.innerHTML = trainings.map(training => `
                <div class="enhanced-card" style="border-left-color: #00bbf9;">
                    <strong style="color: #00bbf9; font-size: 1.1rem;">
                        ${training.day.charAt(0).toUpperCase() + training.day.slice(1)}
                    </strong>
                    <p style="margin: 10px 0;">–î–∞—Ç–∞: ${training.date}</p>
                    <div class="notification-date">
                        ${training.isToday ? 
                            '<span style="color: #ffd60a; font-weight: bold;">‚óè –°—å–æ–≥–æ–¥–Ω—ñ</span>' : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω—É
        async function sendAdminMessage() {
            const message = document.getElementById('adminMessage').value.trim();
            const type = document.getElementById('messageType').value;
            
            if (!message) {
                alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è!');
                return;
            }
            
            const fullMessage = `[${type.toUpperCase()}] ${message}`;
            
            sendToAdmin(fullMessage, currentUser.teamId);
            
            // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
            TeamManager.addTeamNotification(
                currentUser.teamId,
                {
                    title: '–ó–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∞–¥–º—ñ–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ',
                    message: `–¢–∏–ø: ${type}. ${message.substring(0, 50)}...`
                },
                '–°–∏—Å—Ç–µ–º–∞'
            );
            
            document.getElementById('adminMessage').value = '';
            alert('–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            loadMyMessages();
            loadTeamData();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
        async function showAddMemberForm() {
            if (!canEdit) return;
            
            const result = await Modal.showForm('–î–æ–¥–∞—Ç–∏ —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∏', [
                {
                    label: '–ü–æ–≤–Ω–µ —ñ–º\'—è',
                    name: 'name',
                    type: 'text',
                    placeholder: '–Ü–≤–∞–Ω –Ü–≤–∞–Ω–æ–≤',
                    required: true
                },
                {
                    label: '–ü–æ–∑–∏–≤–Ω–∏–π',
                    name: 'callSign',
                    type: 'text',
                    placeholder: '–í–æ–≤–∫',
                    required: true
                },
                {
                    label: '–ó–≤–∞–Ω–Ω—è',
                    name: 'rank',
                    type: 'text',
                    placeholder: '–°–µ—Ä–∂–∞–Ω—Ç',
                    required: true
                },
                {
                    label: '–†–æ–ª—å',
                    name: 'role',
                    type: 'select',
                    options: [
                        { value: 'soldier', text: '–ë–æ–µ—Ü—å' },
                        { value: 'deputy', text: '–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏—Ä–∞' },
                        { value: 'command', text: '–ö–æ–º–∞–Ω–¥–∏—Ä' }
                    ],
                    required: true
                }
            ]);
            
            if (result) {
                TeamManager.addMember(currentUser.teamId, {
                    name: result.name,
                    callSign: result.callSign,
                    rank: result.rank,
                    role: result.role
                });
                
                loadTeamData();
                alert('–ß–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∏ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!');
            }
        }

        function removeMember(memberId) {
            if (!canEdit || !confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ —á–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∏?')) return;
            
            TeamManager.removeMember(currentUser.teamId, memberId);
            loadTeamData();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        async function showAddNotificationForm() {
            if (!canEdit) return;
            
            const result = await Modal.showForm('–î–æ–¥–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è', [
                {
                    label: '–ó–∞–≥–æ–ª–æ–≤–æ–∫',
                    name: 'title',
                    type: 'text',
                    placeholder: '–í–∞–∂–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è',
                    required: true
                },
                {
                    label: '–¢–µ–∫—Å—Ç —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è',
                    name: 'message',
                    type: 'textarea',
                    placeholder: '–¢–µ–∫—Å—Ç –≤–∞—à–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è...',
                    rows: 4,
                    required: true
                }
            ]);
            
            if (result) {
                TeamManager.addTeamNotification(
                    currentUser.teamId, 
                    { 
                        title: result.title, 
                        message: result.message 
                    },
                    currentUser.isCommander ? '–ö–æ–º–∞–Ω–¥–∏—Ä' : 
                    currentUser.isDeputy ? '–ó–∞—Å—Ç—É–ø–Ω–∏–∫' : '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä'
                );
                
                loadTeamData();
                alert('–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!');
            }
        }

        function deleteNotification(notificationId) {
            if (!canEdit || !confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è?')) return;
            
            currentTeam.notifications = currentTeam.notifications.filter(n => n.id !== notificationId);
            TeamManager.saveTeam(currentUser.teamId, currentTeam);
            loadTeamData();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        async function showAddTaskForm() {
            if (!canEdit) return;
            
            const result = await Modal.showForm('–î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è', [
                {
                    label: '–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è',
                    name: 'title',
                    type: 'text',
                    placeholder: '–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è',
                    required: true
                },
                {
                    label: '–û–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è',
                    name: 'description',
                    type: 'textarea',
                    placeholder: '–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è...',
                    rows: 3,
                    required: true
                }
            ]);
            
            if (result) {
                TeamManager.addTask(currentUser.teamId, {
                    title: result.title,
                    description: result.description
                });
                
                loadTeamData();
                alert('–ó–∞–≤–¥–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!');
            }
        }

        function toggleTask(taskId) {
            if (!canEdit) return;
            
            const task = currentTeam.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                TeamManager.saveTeam(currentUser.teamId, currentTeam);
                loadTasks();
            }
        }

        function deleteTask(taskId) {
            if (!canEdit || !confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–≤–¥–∞–Ω–Ω—è?')) return;
            
            currentTeam.tasks = currentTeam.tasks.filter(t => t.id !== taskId);
            TeamManager.saveTeam(currentUser.teamId, currentTeam);
            loadTasks();
        }

        async function reportAbsence() {
            const name = document.getElementById('absenceName').value.trim();
            const date = document.getElementById('absenceDate').value;
            const reason = document.getElementById('absenceReason').value;
            
            if (!name || !date || !reason) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞—Ç—ã
            const dateObj = new Date(date);
            if (isNaN(dateObj.getTime())) {
                alert('–ù–µ–≤—ñ—Ä–Ω–∞ –¥–∞—Ç–∞!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –¥–Ω–µ–º –∑–∞–Ω—è—Ç–∏—è
            if (isTrainingDay(dateObj)) {
                const dayNames = ['–Ω–µ–¥—ñ–ª—è', '–ø–æ–Ω–µ–¥—ñ–ª–æ–∫', '–≤—ñ–≤—Ç–æ—Ä–æ–∫', '—Å–µ—Ä–µ–¥–∞', '—á–µ—Ç–≤–µ—Ä', '–ø\'—è—Ç–Ω–∏—Ü—è', '—Å—É–±–æ—Ç–∞'];
                const dayName = dayNames[dateObj.getDay()];
                
                const confirmMsg = await Modal.show(
                    '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è',
                    `<p><strong>–£–≤–∞–≥–∞!</strong></p>
                     <p>${date} - —Ü–µ –¥–µ–Ω—å –∑–∞–Ω—è—Ç—Ç—è (${dayName}).</p>
                     <p>–í—Å–µ –æ–¥–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å?</p>`,
                    [
                        { text: '–°–∫–∞—Å—É–≤–∞—Ç–∏', class: 'secondary', value: 'cancel' },
                        { text: '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏', class: '', value: 'send' }
                    ]
                );
                
                if (confirmMsg !== 'send') {
                    return;
                }
            }
            
            TeamManager.addAbsence(currentUser.teamId, {
                memberName: name,
                date: date,
                reason: reason
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
            sendToAdmin(
                `–í–Ü–î–°–£–¢–ù–Ü–°–¢–¨: ${name} –Ω–µ –±—É–¥–µ –Ω–∞ –∑–∞–Ω—è—Ç—Ç—è—Ö ${date}. –ü—Ä–∏—á–∏–Ω–∞: ${reason}. –ö–æ–º–∞–Ω–¥–∞: ${currentUser.teamId}`,
                currentUser.teamId
            );
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–∏—Ä—É (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∫–æ–º–∞–Ω–¥–∏—Ä)
            if (!currentUser.isCommander && !currentUser.isDeputy) {
                TeamManager.addTeamNotification(
                    currentUser.teamId,
                    {
                        title: '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å',
                        message: `${name} –Ω–µ –±—É–¥–µ ${date}. –ü—Ä–∏—á–∏–Ω–∞: ${reason}`
                    },
                    '–°–∏—Å—Ç–µ–º–∞'
                );
            }
            
            document.getElementById('absenceName').value = '';
            document.getElementById('absenceDate').value = '';
            
            loadTeamData();
            loadMyMessages();
            
            Modal.show(
                '–£—Å–ø—ñ—à–Ω–æ!',
                `<p>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!</p>
                 <p>–í–æ–Ω–æ –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ ${date} –æ 23:59.</p>`,
                [{ text: 'OK', class: '', value: 'ok' }]
            );
        }

        function deleteAbsence(absenceId) {
            if (!canEdit || !confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å?')) return;
            
            currentTeam.absences = currentTeam.absences.filter(a => a.id !== absenceId);
            TeamManager.saveTeam(currentUser.teamId, currentTeam);
            loadAbsences();
        }

        function showTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (tabName === 'tasks') loadTasks();
            if (tabName === 'absence') {
                loadAbsences();
                loadMyMessages();
            }
            if (tabName === 'notifications') loadAllTeamNotifications();
            if (tabName === 'members') loadTeamMembers();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initTeamPage);
    </script>
</body>
</html>